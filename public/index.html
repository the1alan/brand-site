<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brand — Demo Store (stable)</title>
  <!-- GSAP, ScrollTrigger CDN (Three.js will be attempted but failure is handled silently) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <style>
    /* ========== BASE ========== */
    :root{
      --bg:#070708;
      --panel: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.6);
      --accent: linear-gradient(90deg,#ff5f6d,#ffc371);
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#fff;
      -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
      scroll-behavior:smooth;
    }

    /* ========== VIDEO HERO ========== */
    .hero{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .video-wrap{position:absolute; inset:0; z-index:0; overflow:hidden}
    .video-wrap video{width:100%; height:100%; object-fit:cover; filter:brightness(0.55) contrast(1.05)}
    .overlay{position:absolute; inset:0; z-index:1; display:flex; flex-direction:column; justify-content:center; align-items:flex-start; padding:64px; gap:18px; pointer-events:none}

    .headline{font-size:clamp(28px,6vw,64px); line-height:0.95; letter-spacing:-0.02em; max-width:900px; font-weight:700; background: linear-gradient(90deg,#fff,#ddd); -webkit-background-clip:text; background-clip:text; color:transparent; pointer-events:auto}
    .sub{color:var(--muted); font-size:18px; max-width:700px}

    /* ========== HEADER / LOGO / MENU ========== */
    header{position:fixed; top:0; left:0; right:0; height:76px; display:flex; align-items:center; justify-content:space-between; padding:12px 28px; z-index:50; backdrop-filter: blur(6px)}
    .brand-left{display:flex; gap:16px; align-items:center}
    #logo-canvas{width:64px; height:64px; border-radius:12px; background:var(--glass); cursor:pointer; display:block}
    .brand-name{font-weight:700; margin-left:6px}
    nav{display:flex; gap:18px; align-items:center}
    nav a{color:var(--muted); text-decoration:none; font-weight:600; padding:8px 12px; border-radius:8px}
    nav a:hover{color:#fff; background:rgba(255,255,255,0.03)}
    .menu-btn{display:none}

    /* ========== CONTENT SECTIONS ========== */
    section{padding:96px 6vw; min-height:100vh}
    .panel{background:transparent; border-radius:18px; padding:28px}
    .catalog-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:22px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:12px; backdrop-filter: blur(6px); cursor:pointer; transition:transform .28s ease, box-shadow .28s ease}
    .card:hover{transform:translateY(-8px); box-shadow:0 12px 30px rgba(0,0,0,0.6)}
    .card .thumb{height:260px; border-radius:10px; overflow:hidden; background:#111}
    .card img{width:100%; height:100%; object-fit:cover}
    .card h4{margin:12px 0 6px}
    .price{color:var(--muted)}
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:120}
    .modal.active{display:flex}
    .modal .inner{width:min(900px,95%); background:rgba(10,10,10,0.96); border-radius:14px; padding:22px}
    footer{padding:40px 6vw; color:var(--muted)}
    @media (max-width:800px){ .overlay{padding:24px; align-items:center; text-align:center} header{padding:10px 16px} nav{display:none} .menu-btn{display:block} }
    .cta{margin-top:14px; pointer-events:auto}
    .btn{display:inline-block; padding:12px 18px; border-radius:12px; font-weight:700; text-decoration:none}
    .btn.primary{background:var(--accent); color:#111}
    .muted-small{color:var(--muted); font-size:13px}
  </style>
</head>
<body>

  <header>
    <div class="brand-left">
      <canvas id="logo-canvas" width="64" height="64" aria-label="brand logo"></canvas>
      <div style="display:flex;flex-direction:column;">
        <div class="brand-name">BRAND</div>
        <div class="muted-small">Streetwear • Limited</div>
      </div>
    </div>

    <nav>
      <a href="#catalog">Каталог</a> 
      <a href="#about">О бренде</a>
      <a href="#contacts">Контакты</a>
    </nav>
    <button class="menu-btn btn" aria-label="menu">☰</button>
  </header>

  <div class="video-wrap" style="background:#070708;"></div>


    <div class="overlay">
      <h1 class="headline">История бренда — современная классика в тёмных тонах</h1>
      <p class="sub">Коллекции, вдохновлённые городом и ночной эстетикой. Небольшие коллекции — высокая детализация. Добро пожаловать.</p>
      <div class="cta"><a class="btn primary" href="#catalog">Перейти в каталог</a></div>
    </div>
  </section>

  <section id="catalog">
    <h2 style="font-size:28px; margin-bottom:16px">Каталог</h2>
    <div class="catalog-grid" id="catalog-grid"></div>
  </section>

  <section id="about">
    <div class="panel">
      <h3>О бренде</h3>
      <p class="muted-small">Мы — небольшая команда дизайнеров, работающая на стыке технологий и ремесла. Каждая вещь делается в ограниченном тираже.</p>
      <div style="height:30px"></div>
      <div id="about-visual" style="height:320px; border-radius:12px; overflow:hidden; background:linear-gradient(180deg,#0b0b0b,#121212);"></div>
    </div>
  </section>

  <section id="contacts">
    <div class="panel">
      <h3>Контакты</h3>
      <p class="muted-small">email: hello@brand.example</p>
    </div>
  </section>

  <footer>© Brand — Все права защищены</footer>

  <div class="modal" id="product-modal" role="dialog" aria-modal="true">
    <div class="inner">
      <button id="close-modal" style="float:right" class="btn">✕</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <script>
    // Safe loader: attempt to load external scripts but never reject the startup promise.
    function loadScriptSafe(url, opts = {}){
      return new Promise((resolve) => {
        // If already present and loaded -> resolve true
        const found = Array.from(document.scripts).find(s => s.src && s.src.indexOf(url) !== -1);
        if(found){
          if(found.getAttribute('data-loaded') === 'true') return resolve(true);
          found.addEventListener('load', ()=> resolve(true));
          found.addEventListener('error', ()=> resolve(false));
          return;
        }
        const s = document.createElement('script');
        s.src = url;
        s.async = false; // keep order predictable
        s.onload = () => { s.setAttribute('data-loaded','true'); resolve(true); };
        s.onerror = () => { resolve(false); };
        if(opts.crossorigin) s.crossOrigin = opts.crossorigin;
        document.head.appendChild(s);
      });
    }

    // Attempt to load Three.js but handle environments that block CDNs gracefully.
    async function tryLoadThree(){
      if(window.THREE) return true;
      const threeUrl = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js';
      try{
        const ok = await loadScriptSafe(threeUrl);
        if(!ok) return false;
        return !!window.THREE;
      }catch(e){
        return false;
      }
    }

    // Initialize 3D logo (requires THREE to be present)
    function init3DLogo(){
      try{
        const logoCanvas = document.getElementById('logo-canvas');
        if(!logoCanvas) return;
        const renderer = new THREE.WebGLRenderer({canvas:logoCanvas, alpha:true, antialias:true});
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(64,64);
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45,1,0.1,100); camera.position.z = 2.6;
        const light = new THREE.DirectionalLight(0xffffff,1); light.position.set(5,5,5); scene.add(light);
        scene.add(new THREE.AmbientLight(0xffffff,0.3));
        const geom = new THREE.BoxGeometry(1.2,1.2,0.18);
        const mat = new THREE.MeshStandardMaterial({color:0x111111, metalness:0.7, roughness:0.2});
        const box = new THREE.Mesh(geom, mat); scene.add(box);
        const plane = new THREE.Mesh(new THREE.PlaneGeometry(1.2,1.2), new THREE.MeshBasicMaterial({color:0xffffff, transparent:true, opacity:0.02}));
        plane.position.z = 0.11; scene.add(plane);
        function render(){ renderer.render(scene, camera); }
        render();
        // interactions
        logoCanvas.addEventListener('mouseenter', ()=>{ gsap.to(box.rotation, {y:box.rotation.y + Math.PI*1.8, x:box.rotation.x + 0.9, duration:1.1, ease:'power3.out'}); gsap.to(box.scale, {x:1.06, y:1.06, z:1.06, duration:0.6}); gsap.ticker.add(render); });
        logoCanvas.addEventListener('mouseleave', ()=>{ gsap.to(box.rotation, {x:0,y:0,duration:1.2, ease:'elastic.out(1,0.6)'}); gsap.to(box.scale, {x:1,y:1,z:1, duration:0.8}); setTimeout(()=>{ gsap.ticker.remove(render); render(); }, 1200); });
        gsap.to(box.rotation, {y:Math.PI*2, duration:18, repeat:-1, ease:'none'}); gsap.ticker.add(render);
        window.addEventListener('resize', ()=>{ renderer.setSize(64,64); render(); });
        console.log('3D logo initialized');
      }catch(err){
        console.warn('Failed to initialize 3D logo:', err);
        init2DLogoFallback();
      }
    }

    // 2D canvas fallback logo (works in sandboxed environments)
    function init2DLogoFallback(){
      const canvas = document.getElementById('logo-canvas');
      if(!canvas) return;
      const ctx = canvas.getContext && canvas.getContext('2d');
      if(!ctx) return;
      const w = canvas.width = 64; const h = canvas.height = 64;
      let angle = 0;
      function draw(){
        ctx.clearRect(0,0,w,h);
        // background soft
        ctx.fillStyle = 'rgba(255,255,255,0.02)'; ctx.fillRect(0,0,w,h);
        ctx.save(); ctx.translate(w/2,h/2); ctx.rotate(angle);
        // main square
        ctx.fillStyle = '#111'; ctx.fillRect(-18,-18,36,36);
        // thin outline
        ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 1.5; ctx.strokeRect(-18,-18,36,36);
        // brand initial
        ctx.fillStyle = 'rgba(255,255,255,0.9)'; ctx.font = '700 14px Arial'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('B',0,2);
        ctx.restore();
        angle += 0.03;
        requestAnimationFrame(draw);
      }
      draw();
      console.log('2D logo fallback running');
    }

    // Core UI: animations, catalog etc. (runs regardless of Three availability)
    function initUI(){
      try{ gsap.registerPlugin(ScrollTrigger); }catch(e){}
      gsap.from('.headline', {y:40, opacity:0, duration:1.2, ease:'power3.out'});
      gsap.from('.sub', {y:20, opacity:0, duration:1, delay:0.2, ease:'power3.out'});
      gsap.from('.cta', {y:8, opacity:0, duration:1, delay:0.4});
      if(window.ScrollTrigger){
        gsap.to('#about-visual', { scrollTrigger:{ trigger:'#about-visual', start:'top 80%', toggleActions:'play none none reverse'}, backgroundPosition:'0% 80%', duration:2, ease:'power2.out' });
      }

      const products = [
        {id:1, title:'Black Oversized Hoodie', price:'€89', img:'https://picsum.photos/id/1011/800/1000'},
        {id:2, title:'Night Runner Jacket', price:'€129', img:'https://picsum.photos/id/1018/800/1000'},
        {id:3, title:'Minimal Tee', price:'€39', img:'https://picsum.photos/id/1025/800/1000'},
        {id:4, title:'Signature Cap', price:'€29', img:'https://picsum.photos/id/1005/800/1000'},
        {id:5, title:'Cargo Trousers', price:'€99', img:'https://picsum.photos/id/1043/800/1000'},
        {id:6, title:'Leather Boots', price:'€189', img:'https://picsum.photos/id/1059/800/1000'}
      ];
      const grid = document.getElementById('catalog-grid');
      products.forEach(p=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `<div class="thumb"><img src="${p.img}" alt="${p.title}"></div><h4>${p.title}</h4><div class="price">${p.price}</div>`;
        card.addEventListener('click', ()=> openModal(p)); grid.appendChild(card);
      });

      const modal = document.getElementById('product-modal'); const modalContent = document.getElementById('modal-content');
      document.getElementById('close-modal').addEventListener('click', ()=> closeModal());
      function openModal(p){
        modalContent.innerHTML = `<div style="display:flex; gap:18px; align-items:stretch;"><div style="flex:1; min-width:260px;"><img src="${p.img}" style="width:100%; border-radius:8px;"/></div><div style="flex:1.2"><h2>${p.title}</h2><p class="muted-small">Доступные размеры: S, M, L. Высокое качество материалов. Ограниченный тираж.</p><p style="margin-top:18px; font-size:20px; font-weight:800">${p.price}</p><div style="margin-top:22px;"><a class="btn primary" href="#">Купить</a></div></div></div>`;
        modal.classList.add('active'); gsap.from('.modal .inner', {y:40, opacity:0, duration:0.5});
      }
      function closeModal(){ modal.classList.remove('active'); }
      modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); })

      const links = document.querySelectorAll('nav a'); links.forEach(a=>{ a.addEventListener('click', (e)=>{ e.preventDefault(); const id = a.getAttribute('href'); document.querySelector(id).scrollIntoView({behavior:'smooth'}); }) });
      document.addEventListener('keydown', e=>{ if(e.key === 'Escape') closeModal(); })
      document.addEventListener('visibilitychange')

      console.log('UI initialized');
    }

    // startup: attempt to load Three, then choose 3D or 2D logo, always init UI
    (async function startup(){
      const threeOk = await tryLoadThree();
      if(threeOk){ try{ init3DLogo(); }catch(e){ console.warn('3D init error, falling back to 2D', e); init2DLogoFallback(); } }
      else { console.warn('Three.js not available — using 2D logo fallback'); init2DLogoFallback(); }
      initUI();
    })();
  </script>
</body>
</html>
